{% macro display_rule(rule) %}
    {% for action in rule['ACTIONS'] %}
        <tr>
            <td>
                <a href="{{ url_for('controller.action_routes', uri=action['URI']) }}">
                    {{ action['LABEL'] }}
                </a>
            </td>
            <td>{{ display_parties(rule['ASSIGNORS']) }}</td>
            <td>{{ display_parties(rule['ASSIGNEES']) }}</td>
        </tr>
        {% endfor %}
        {% if rule['ACTIONS']|length == 0 and (rule['ASSIGNORS']|length > 0 or rule['ASSIGNEES']|length > 0) %}
        <tr>
            <td></td>
            <td>{{ display_parties(rule['ASSIGNORS']) }}</td>
            <td>{{ display_parties(rule['ASSIGNEES']) }}</td>
        </tr>
        {% endif %}
{% endmacro %}
{% macro display_parties(parties) %}
    {% set comma = joiner(', ') %}
    {% for party in parties %}
        {{ comma() }}
        <a href="{{ url_for('controller.party_routes', uri=party['URI']) }}">{{ party['LABEL'] if party['LABEL'] else party['URI'] }}</a>
    {% endfor %}
{% endmacro %}

{% extends 'browse.html' %}
{% block title %}
<h1>Viewing Licence:</h1>
<h2>{% if title is defined %}{{ title }}{% endif %}</h2>
{% endblock %}
{% block info %}
<table class="table">
    <col width="150">
    <tbody>
        <tr>
            <th>Type:</th>
            <td>{% if licence['TYPE'] is not none %}{{ licence['TYPE'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Description:</th>
            <td>{% if licence['COMMENT'] is not none %}{{ licence['COMMENT'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Status:</th>
            <td>{% if licence['STATUS'] is not none %}{{ licence['STATUS'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Version:</th>
            <td>{% if licence['HAS_VERSION'] is not none %}{{ licence['HAS_VERSION'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Created:</th>
            <td>{% if licence['CREATED'] is not none %}{{ licence['CREATED'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Creator:</th>
            <td>{% if licence['CREATOR'] is not none %}{{ licence['CREATOR'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Jurisdiction:</th>
            <td>{% if licence['JURISDICTION'] is not none %}{{ licence['JURISDICTION'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Legal Code:</th>
            <td>{% if licence['LEGAL_CODE'] is not none %}{{ licence['LEGAL_CODE'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Language:</th>
            <td>{% if licence['LANGUAGE'] is not none %}{{ licence['LANGUAGE'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>Same As:</th>
            <td>{% if licence['SAME_AS'] is not none %}{{ licence['SAME_AS'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>See Also:</th>
            <td>{% if licence['SEE_ALSO'] is not none %}{{ licence['SEE_ALSO'] }}{% endif %}</td>
        </tr>
        <tr>
            <th>URI:</th>
            <td>{% if licence['URI'] is not none %}{{ licence['URI'] }}{% endif %}</td>
        </tr>
    </tbody>
</table>
{% endblock %}
{% block right_column %}
{% if logo is not none %}<img src="{{ licence['LOGO'] }}" alt="Licence Logo">{% endif %}
{% endblock %}
{% block bottom %}
<h2>Rules</h2>
{% if not permissions and not duties and not prohibitions %}None{% endif %}
<ul id="rule-list-template" class="pl-0">
    {% if permissions %}
    <li class="list-group-item font-weight-bold active">Permissions</li>
    <li class="list-group-item">
        <table class="table">
            <thead>
                <tr>
                    <th>Action</th>
                    <th>Assignors</th>
                    <th>Assignees</th>
                </tr>
            </thead>
            <tbody>
                {% for permission in permissions %}
                    {{ display_rule(permission) }}
                {% endfor %}
            </tbody>
        </table>
    </li>
    {% endif %}
    {% if duties %}
    <li class="list-group-item font-weight-bold active">Duties</li>
    <li class="list-group-item">
        <table class="table">
            <thead>
                <tr>
                    <th>Action</th>
                    <th>Assignors</th>
                    <th>Assignees</th>
                </tr>
            </thead>
            <tbody>
                {% for duty in duties %}
                    {{ display_rule(duty) }}
                {% endfor %}
            </tbody>
        </table>
    </li>
    {% endif %}
    {% if prohibitions %}
    <li class="list-group-item font-weight-bold active">Prohibitions</li>
    <li class="list-group-item">
        <table class="table">
            <thead>
                <tr>
                    <th>Action</th>
                    <th>Assignors</th>
                    <th>Assignees</th>
                </tr>
            </thead>
            <tbody>
                {% for prohibition in prohibitions %}
                    {{ display_rule(prohibition) }}
                {% endfor %}
            </tbody>
        </table>
    </li>
    {% endif %}
</ul>
{% endblock %}